# MindCode æž¶æž„å®¡è®¡æŠ¥å‘Š

> å®¡è®¡æ—¥æœŸï¼š2026-02-18 | å®¡è®¡èŒƒå›´ï¼š`src/main/` `src/renderer/` `src/core/` `src/types/` | è¯„åˆ†ï¼š72/100

---

## ç¬¬ä¸€ç« ï¼šæ‰§è¡Œæ‘˜è¦

### 1.1 é¡¹ç›®æ¦‚å†µ

MindCode æ˜¯åŸºäºŽ Electron + React + TypeScript + Monaco Editor çš„ AI åŽŸç”Ÿä»£ç ç¼–è¾‘å™¨ï¼Œæ”¯æŒ 7 ç§ AI æ¨¡åž‹ï¼ˆClaude / GPT / Gemini / DeepSeek / GLM / Codesuc / Ollamaï¼‰ã€‚

| ç»´åº¦ | çŽ°çŠ¶ |
|------|------|
| ä»£ç è§„æ¨¡ | ~55,000 è¡Œ TypeScript |
| æž¶æž„æ¨¡å¼ | Main/Renderer åŒè¿›ç¨‹ + Zustand çŠ¶æ€ç®¡ç† |
| AI é›†æˆ | å¤š Provider ç»Ÿä¸€æŽ¥å£ + è¯·æ±‚æµæ°´çº¿ |
| LSP | å¤šè¯­è¨€æ”¯æŒï¼ˆTS/JS/Python/Go/Rustï¼‰ |
| æ’ä»¶ç³»ç»Ÿ | Manifest + CommandRegistryï¼Œæ— æ²™ç›’ |

### 1.2 äº”å¤§äº®ç‚¹

1. **IPC ç±»åž‹ç³»ç»Ÿå®Œæ•´**ï¼š667 è¡Œç±»åž‹å®šä¹‰è¦†ç›–å…¨éƒ¨é€šé“ï¼Œpreload ç™½åå•å¼æš´éœ²
2. **AI è¯·æ±‚æµæ°´çº¿**ï¼šä¼˜å…ˆçº§é˜Ÿåˆ— + å¹¶å‘æŽ§åˆ¶(3) + ç†”æ–­å™¨ + StreamBuffer(16ms@60fps)
3. **ç¼–ç æ™ºèƒ½æ£€æµ‹**ï¼šchardet + iconv-lite æ”¯æŒ 10+ ç¼–ç è‡ªåŠ¨æ£€æµ‹
4. **Zustand çŠ¶æ€ç®¡ç†**ï¼šæ›¿ä»£ Contextï¼Œé¿å… Provider åµŒå¥—
5. **é”™è¯¯è¾¹ç•Œå®Œå–„**ï¼šCodeEditor / AIPanel åŒå±‚ ErrorBoundary

### 1.3 åå¤§é£Žé™©

| # | çº§åˆ« | é£Žé™© | ä½ç½® |
|---|------|------|------|
| 1 | P0 | ç»ˆç«¯å‘½ä»¤æ³¨å…¥ | `terminal-handlers.ts:116-138` |
| 2 | P0 | æ’ä»¶æ— æ²™ç›’ | `plugins/manager.ts:142-271` |
| 3 | P0 | Provider æ— å“åº”å¤§å°é™åˆ¶ | `providers/claude.ts:79-103` |
| 4 | P0 | API Key æ˜Žæ–‡å­˜å‚¨ | `ai-handlers.ts:60-105` |
| 5 | P0 | LSP Windows cmd æ³¨å…¥ | `lsp-manager.ts:137-149` |
| 6 | P0 | DAP spawn çŽ¯å¢ƒå˜é‡æ³¨å…¥ | `dap-client.ts:115-131` |
| 7 | P0 | fs-handlers ç¬¦å·é“¾æŽ¥ç©¿è¶Š | `fs-handlers.ts:64-96` |
| 8 | P0 | ç´¢å¼•æœåŠ¡ OOM | `indexService.ts` sql.js æ— å†…å­˜é™åˆ¶ |
| 9 | P1 | AI è¶…æ—¶ 180s è¿‡é•¿ | `llm-client.ts TIMEOUT_READ_MS` |
| 10 | P1 | PTY ç»§æ‰¿å…¨éƒ¨çŽ¯å¢ƒå˜é‡ | `terminal-handlers.ts:173` |

### 1.4 ä¸‰é¡¹ç«‹å³è¡ŒåŠ¨

1. **[P0-å®‰å…¨]** ä¿®å¤ç»ˆç«¯å‘½ä»¤æ³¨å…¥ï¼šæ·»åŠ  Shell å…ƒå­—ç¬¦è¿‡æ»¤ + `execAsync` â†’ `spawn`
2. **[P0-å®‰å…¨]** ä¿®å¤ fs-handlers ç¬¦å·é“¾æŽ¥ç©¿è¶Šï¼š`path.resolve` â†’ `fs.realpathSync`
3. **[P0-å®‰å…¨]** API Key è¿ç§»åˆ° keytar å®‰å…¨å­˜å‚¨

---

## ç¬¬äºŒç« ï¼šç³»ç»Ÿæ€»è§ˆ

### 2.1 è¿›ç¨‹æ¨¡åž‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Main Process               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ IPC Hub â”‚  â”‚ Terminal â”‚  â”‚  LSP   â”‚ â”‚
â”‚  â”‚ (8æ¨¡å—)  â”‚  â”‚  (PTY)   â”‚  â”‚Manager â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ preload.ts (contextBridge ç™½åå•)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       â–¼     Renderer Process             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Zustand â”‚  â”‚  Monaco  â”‚  â”‚  React â”‚ â”‚
â”‚  â”‚ Stores  â”‚  â”‚  Editor  â”‚  â”‚  Tree  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—ä¾èµ–å›¾

```
index.ts (å…¥å£)
  â”œâ”€â”€ ipc/fs-handlers.ts      â†’ core/encoding
  â”œâ”€â”€ ipc/ai-handlers.ts      â†’ core/ai/*
  â”œâ”€â”€ ipc/git-handlers.ts     â†’ child_process
  â”œâ”€â”€ ipc/terminal-handlers.ts â†’ node-pty
  â”œâ”€â”€ ipc/settings-handlers.ts â†’ electron-store
  â”œâ”€â”€ ipc/debug-handlers.ts   â†’ debugger/dap-client
  â”œâ”€â”€ ipc/lsp-handlers.ts     â†’ lsp-manager
  â””â”€â”€ ipc/index-handlers.ts   â†’ core/indexing
```

### 2.3 å…³é”®è·¯å¾„

| è·¯å¾„ | é“¾è·¯ | é£Žé™©ç‚¹ |
|------|------|--------|
| AI å¯¹è¯ | Renderer â†’ IPC â†’ ai-handlers â†’ llm-client â†’ Provider â†’ SSE | æ— å“åº”å¤§å°é™åˆ¶ã€180s è¶…æ—¶ |
| æ–‡ä»¶æ“ä½œ | Renderer â†’ IPC â†’ fs-handlers â†’ fs | ç¬¦å·é“¾æŽ¥ç©¿è¶Š |
| ç»ˆç«¯æ‰§è¡Œ | Renderer â†’ IPC â†’ terminal-handlers â†’ node-pty/exec | å‘½ä»¤æ³¨å…¥ |
| ä»£ç è¡¥å…¨ | Editor â†’ completion-service â†’ Provider â†’ StreamBuffer | Ghost Text ç«žæ€ |

---

## ç¬¬ä¸‰ç« ï¼šé¢†åŸŸå®¡è®¡

### 3.1 Electron ä¸Žå®‰å…¨

**âœ… åšå¾—å¥½çš„ï¼š**
- `nodeIntegration: false` + `contextIsolation: true`
- preload.ts ç™½åå•å¼ API æš´éœ²ï¼ˆ738 è¡Œä¸¥æ ¼å®šä¹‰ï¼‰
- fs-handlers ä¸‰å±‚è·¯å¾„æ ¡éªŒï¼ˆresolve â†’ å·¥ä½œåŒºè¾¹ç•Œ â†’ ç³»ç»Ÿç›®å½•é»‘åå•ï¼‰

**âš ï¸ é£Žé™©ï¼š**
- `sandbox: true` æœªæ˜¾å¼è®¾ç½®ï¼ˆElectron 30 é»˜è®¤å¼€å¯ä½†åº”æ˜¾å¼å£°æ˜Žï¼‰
- æ—  CSPï¼ˆContent Security Policyï¼‰é…ç½®
- å¼€å‘æ¨¡å¼ DevTools è‡ªåŠ¨æ‰“å¼€æ— æ¡ä»¶åˆ¤æ–­

**ðŸ› ï¸ ä¿®å¤å»ºè®®ï¼š**
```typescript
// index.ts:59 - æ˜¾å¼å¯ç”¨æ²™ç›’
webPreferences: {
  sandbox: true, // æ–°å¢ž
  nodeIntegration: false,
  contextIsolation: true,
  preload: path.join(__dirname, "preload.js"),
}
```

### 3.2 ç»ˆç«¯å®‰å…¨ [P0]

**âš ï¸ ä¸¥é‡æ¼æ´žï¼š**

1. **Shell å…ƒå­—ç¬¦æ³¨å…¥**ï¼ˆ`terminal-handlers.ts:116-138`ï¼‰
   - `isCommandSafe()` ä»…æ£€æŸ¥å‘½ä»¤å‰ç¼€ç™½åå•å’Œå±é™©å‘½ä»¤é»‘åå•
   - æœªè¿‡æ»¤ `;` `&&` `||` `|` `>` `<` `` ` `` `$()` ç­‰ Shell å…ƒå­—ç¬¦
   - æ”»å‡»ç¤ºä¾‹ï¼š`echo hello; rm -rf /`ï¼ˆ`echo` åœ¨ç™½åå•ä¸­ï¼‰

2. **exec + shell:true**ï¼ˆ`terminal-handlers.ts:252-284`ï¼‰
   - `execAsync` ä½¿ç”¨ `shell: true`ï¼Œå‘½ä»¤ç›´æŽ¥ä¼ å…¥ Shell è§£é‡Šå™¨
   - åº”æ”¹ä¸º `spawn` + `shell: false` + å‚æ•°æ•°ç»„

3. **PTY çŽ¯å¢ƒå˜é‡æ³„éœ²**ï¼ˆ`terminal-handlers.ts:173`ï¼‰
   - `env: process.env` å°†æ‰€æœ‰çŽ¯å¢ƒå˜é‡ï¼ˆå« API Keyï¼‰ä¼ å…¥ PTY

### 3.3 æ–‡ä»¶ç³»ç»Ÿå®‰å…¨ [P0]

**âš ï¸ ç¬¦å·é“¾æŽ¥ç©¿è¶Š**ï¼ˆ`fs-handlers.ts:64-96`ï¼‰
- `isPathAllowed()` ä½¿ç”¨ `path.resolve()` ä¸è·Ÿéšç¬¦å·é“¾æŽ¥
- æ”»å‡»è€…å¯åˆ›å»ºæŒ‡å‘ `/etc/passwd` çš„ç¬¦å·é“¾æŽ¥ç»•è¿‡è·¯å¾„æ ¡éªŒ
- ä¿®å¤ï¼šæ”¹ç”¨ `fs.realpathSync()` è§£æžçœŸå®žè·¯å¾„

### 3.4 AI å¹³å°å±‚

**âœ… åšå¾—å¥½çš„ï¼š**
- ç»Ÿä¸€ Provider æŽ¥å£ + model-router è·¯ç”±
- è¯·æ±‚æµæ°´çº¿ï¼šä¼˜å…ˆçº§é˜Ÿåˆ—(3çº§) + å¹¶å‘æŽ§åˆ¶(3) + ç†”æ–­å™¨(threshold=3, reset=30s)
- StreamBuffer 16ms æ‰¹å¤„ç† @60fps
- è¿žæŽ¥é¢„çƒ­ï¼ˆHEAD è¯·æ±‚ï¼‰+ è¯·æ±‚åŽ»é‡ + å“åº”ç¼“å­˜(60s TTL, 100æ¡)

**âš ï¸ é£Žé™©ï¼š**
- Claude/GLM/Codesuc Provider è‡ªå®žçŽ° HTTPï¼ˆæœªä½¿ç”¨ SDKï¼‰
- æ— å“åº”ä½“å¤§å°é™åˆ¶ï¼š`data += chunk` æ— ä¸Šé™ï¼ˆ`claude.ts:79-103`ï¼‰
- API Key å…¨éƒ¨æ˜Žæ–‡å­˜äºŽå†…å­˜ï¼ˆ`ai-handlers.ts:60-105`ï¼‰
- è¶…æ—¶ 180s è¿‡é•¿ï¼ˆ`llm-client.ts TIMEOUT_READ_MS`ï¼‰
- é‡è¯•ç­–ç•¥ä¸åŒºåˆ†é”™è¯¯ç±»åž‹ï¼ˆ429 vs 500 ä½¿ç”¨ç›¸åŒç­–ç•¥ï¼Œä¸è¯» Retry-Afterï¼‰
- Codesuc Agent Loop XML è§£æžçŠ¶æ€æœºè„†å¼±

**ðŸ› ï¸ ä¿®å¤å»ºè®®ï¼š**
- Claude Provider è¿ç§»åˆ° `@anthropic-ai/sdk`ï¼ˆå·²åœ¨ dependencies ä¸­ä½†æœªä½¿ç”¨ï¼‰
- æ·»åŠ  10MB å“åº”å¤§å°ç¡¬é™åˆ¶
- è¶…æ—¶è°ƒæ•´ä¸º 60s
- API Key è¿ç§»åˆ° keytar

### 3.5 ä»£ç è¡¥å…¨

**âœ… åšå¾—å¥½çš„ï¼š**
- 20ms é˜²æŠ– + 5s ç¼“å­˜ TTL + 100 æ¡ä¸Šé™
- AbortController å–æ¶ˆæœºåˆ¶
- `shouldComplete()` è·³è¿‡æ³¨é‡Š/å­—ç¬¦ä¸²

**âš ï¸ é£Žé™©ï¼š**
- Ghost Text ä½¿ç”¨å…¨å±€ `inlineCompletionDisposable` å˜é‡ â†’ å¤šç¼–è¾‘å™¨ç«žæ€

### 3.6 LSP é›†æˆ

**âœ… åšå¾—å¥½çš„ï¼š**
- å¤šè¯­è¨€æ”¯æŒï¼ˆTS/JS/Python/Go/Rustï¼‰
- è‡ªåŠ¨é‡å¯ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰

**âš ï¸ é£Žé™©ï¼š**
- Windows ä½¿ç”¨ `cmd.exe /c` å¯åŠ¨ï¼Œå‘½ä»¤åå« `&` å¯æ³¨å…¥ï¼ˆ`lsp-manager.ts:137-149`ï¼‰
- æ— é‡è¿žæœºåˆ¶ï¼šstart() å¤±è´¥åŽçŠ¶æ€æ°¸ä¹…ä¸º 'error'
- éžæ ‡å‡†å¥åº·æ£€æŸ¥ `$/alive`ï¼ˆåº”ä½¿ç”¨æ ‡å‡† `initialized` é€šçŸ¥ï¼‰
- é‡å¯å›ºå®š 2s å»¶è¿Ÿï¼ˆæ— æŒ‡æ•°é€€é¿ï¼‰
- æ— è¯·æ±‚è¶…æ—¶ä¿æŠ¤
- æ— è¯Šæ–­èŠ‚æµ

### 3.7 ä»£ç ç´¢å¼•

**âš ï¸ é£Žé™©ï¼š**
- sql.js å†…å­˜æ•°æ®åº“æ— å¤§å°é™åˆ¶ â†’ å¤§é¡¹ç›® OOM
- 300ms é˜²æŠ–ä¸è¶³ä»¥åº”å¯¹å¿«é€Ÿç¼–è¾‘çš„ç«žæ€
- æ–‡ä»¶å¤§å°é™åˆ¶ 1MB âœ…ã€é€’å½’æ·±åº¦é™åˆ¶ 10 âœ…

### 3.8 è°ƒè¯•å™¨ (DAP)

**âš ï¸ é£Žé™©ï¼š**
- `spawn()` æŽ¥å—æ¸²æŸ“è¿›ç¨‹ä¼ å…¥çš„ä»»æ„ `env`ï¼ˆLD_PRELOAD æ³¨å…¥ï¼‰
- `args` æœªæ ¡éªŒ
- DAP åè®®ä¸å®Œæ•´ï¼ˆç¼ºå°‘ threads/scopes/sourceMapï¼‰
- ä»…æ”¯æŒå•ä¸€æ´»è·ƒä¼šè¯

### 3.9 æ’ä»¶ç³»ç»Ÿ [P0]

**âš ï¸ ä¸¥é‡æ¼æ´žï¼š**
- **æ— æ²™ç›’éš”ç¦»**ï¼šæ’ä»¶é€šè¿‡ `createAPI()` ç›´æŽ¥è®¿é—® fs/editor/ai/terminal
- **æ— ç­¾åéªŒè¯**ï¼šä»»æ„ `manifest.json` ç›´æŽ¥åŠ è½½
- **æƒé™ç±»åž‹å®šä¹‰ä½†ä»Žæœªæ£€æŸ¥**ï¼š`PluginPermission` ç±»åž‹å­˜åœ¨ä½†åŠ è½½æ—¶ä¸æ ¡éªŒ
- fs API æ— è·¯å¾„æ ¡éªŒï¼ˆ`manager.ts:194-208`ï¼‰

### 3.10 æ¸²æŸ“å±‚

**âš ï¸ é£Žé™©ï¼š**
- `App.tsx` é”®ç›˜äº‹ä»¶ useEffect ä¾èµ–æ•°ç»„ä¸å®Œæ•´ï¼ˆ2é¡¹ä½†å¼•ç”¨10+å˜é‡ï¼‰â†’ è¿‡æœŸé—­åŒ…
- `DiffEditor` åˆ›å»º Monaco model æœª dispose â†’ å†…å­˜æ³„æ¼
- `useAIStore.appendStreamingText` é€ token setState â†’ æ¸²æŸ“é£Žæš´
- AI Store 15+ çŠ¶æ€å­—æ®µåœ¨å•ä¸€ store â†’ ä»»ä½•å˜æ›´è§¦å‘å…¨éƒ¨è®¢é˜…è€…

### 3.11 å·¥ç¨‹åŒ–

**âœ… åšå¾—å¥½çš„ï¼š**
- IPC ç±»åž‹å®šä¹‰ 667 è¡Œå®Œæ•´è¦†ç›–
- CI/CD è„šæœ¬å®Œå–„ï¼ˆlint/format/test/build/dist å…¨é“¾è·¯ï¼‰
- husky + lint-staged ä»£ç è´¨é‡é—¨ç¦
- Zustand æ›¿ä»£ Context é¿å…åµŒå¥—

**âš ï¸ é£Žé™©ï¼š**
- 323 å¤„ `any` ç±»åž‹ï¼ˆåº”é€æ­¥æ›¿æ¢ä¸ºå…·ä½“ç±»åž‹ï¼‰
- æµ‹è¯•è¦†ç›–çŽ‡ ~25%
- React åœ¨ devDependencies è€Œéž dependenciesï¼ˆElectron æ‰“åŒ…å¯èƒ½ä¸¢å¤±ï¼‰

---

## ç¬¬å››ç« ï¼šCursor å·®è·åˆ†æž

### 4.1 åŠŸèƒ½å·®è·

| åŠŸèƒ½ | Cursor | MindCode | å·®è· |
|------|--------|----------|------|
| Multi-file Edit | âœ… å¤šæ–‡ä»¶è”åŠ¨ç¼–è¾‘ | âŒ å•æ–‡ä»¶ | é«˜ |
| Codebase-aware AI | âœ… å…¨é¡¹ç›®ä¸Šä¸‹æ–‡ | âš ï¸ ä»…å½“å‰æ–‡ä»¶ | é«˜ |
| Inline Diff | âœ… å†…è”å·®å¼‚é¢„è§ˆ | âš ï¸ ç‹¬ç«‹ DiffEditor | ä¸­ |
| AI Terminal | âœ… ç»ˆç«¯ AI è¾…åŠ© | âŒ æ—  | ä¸­ |
| @ Mentions | âœ… @file @folder | âŒ æ—  | é«˜ |
| Tab Completion | âœ… å¤šå€™é€‰ Tab | âš ï¸ å•å€™é€‰ Ghost Text | ä¸­ |
| Extension Market | âœ… VSCode ç”Ÿæ€ | âŒ æ— å¸‚åœº | é«˜ |

### 4.2 ä½“éªŒå·®è·

| ç»´åº¦ | å·®è·æè¿° |
|------|----------|
| å“åº”é€Ÿåº¦ | AI æµå¼å»¶è¿Ÿï¼ˆæ—  StreamBuffer ä¼˜åŒ–å®žé™…å·²æœ‰ï¼Œä½† store é€ token æ›´æ–°ï¼‰ |
| é”™è¯¯æ¢å¤ | LSP å´©æºƒæ— è‡ªåŠ¨é‡è¿žã€Recovery ä½¿ç”¨ localStorage |
| å¤šçª—å£ | ç¼ºå°‘çª—å£é—´çŠ¶æ€åŒæ­¥ |
| ä¸»é¢˜åˆ‡æ¢ | 30+ ä¸»é¢˜ä½†æ— å®žæ—¶é¢„è§ˆ |

### 4.3 å·¥ç¨‹å·®è·

| ç»´åº¦ | å·®è·æè¿° |
|------|----------|
| æµ‹è¯• | è¦†ç›–çŽ‡ ~25%ï¼Œå…³é”®è·¯å¾„ç¼ºæµ‹è¯• |
| å®‰å…¨ | 7 ä¸ª P0 å®‰å…¨æ¼æ´ž |
| æ€§èƒ½ | å¤§å·¥ä½œåŒºé¦–æ¬¡åŠ è½½æ— è™šæ‹ŸåŒ– |
| å¯è§‚æµ‹æ€§ | ä»… console.logï¼Œæ— ç»“æž„åŒ–æ—¥å¿—/æŒ‡æ ‡ |

---

## ç¬¬äº”ç« ï¼šè¿­ä»£è·¯çº¿å›¾

### P0 - å®‰å…¨ä¸Žç¨³å®šæ€§ï¼ˆç«‹å³ä¿®å¤ï¼‰

| ç¼–å· | ä»»åŠ¡ | æ–‡ä»¶ | æ ¸å¿ƒæ“ä½œ |
|------|------|------|----------|
| T1 | ç»ˆç«¯å‘½ä»¤æ³¨å…¥ä¿®å¤ | `terminal-handlers.ts` | Shell å…ƒå­—ç¬¦è¿‡æ»¤ + `execAsync`â†’`spawn` + çŽ¯å¢ƒå˜é‡ç™½åå• |
| T2 | æ’ä»¶æ²™ç›’æƒé™ | `plugins/manager.ts` | è·¯å¾„æ ¡éªŒ + æƒé™æ£€æŸ¥ + API è°ƒç”¨å®¡è®¡ |
| T3 | Provider å“åº”é™åˆ¶ | `providers/*.ts` | 10MB å“åº”ä¸Šé™ + Claude è¿ç§» SDK |
| T4 | API Key å®‰å…¨å­˜å‚¨ | `ai-handlers.ts` | è¿ç§»åˆ° keytar |
| T5 | fs ç¬¦å·é“¾æŽ¥ä¿®å¤ | `fs-handlers.ts` | `path.resolve`â†’`fs.realpathSync` |
| T6 | LSP å‘½ä»¤æ³¨å…¥ä¿®å¤ | `lsp-manager.ts` | Windows spawn å‚æ•°åˆ†ç¦» |
| T7 | DAP env ç™½åå• | `dap-client.ts` | è¿‡æ»¤ env/args |
| T8 | AI è¶…æ—¶è°ƒæ•´ | `llm-client.ts` | 180sâ†’60s + æµå¼ 30s æ— æ•°æ®è¶…æ—¶ |
| T9 | ç´¢å¼• OOM é˜²æŠ¤ | `indexService.ts` | sql.js å†…å­˜é™åˆ¶ + å¢žé‡ç´¢å¼• |
| T10 | App.tsx é—­åŒ…ä¿®å¤ | `App.tsx` | useEffect ä¾èµ–æ•°ç»„è¡¥å…¨ |
| T11 | DiffEditor æ³„æ¼ | `DiffEditor.tsx` | model dispose |
| T12 | CSP é…ç½® | `index.ts` | session.defaultSession.webRequest |
| T13 | sandbox æ˜¾å¼å£°æ˜Ž | `index.ts` | `sandbox: true` |

### P1 - ä½“éªŒä¸Žæ€§èƒ½

| ç¼–å· | ä»»åŠ¡ | æ ¸å¿ƒæ“ä½œ |
|------|------|----------|
| T14 | AI æµå¼æ¸²æŸ“ä¼˜åŒ– | `appendStreamingText` æ‰¹é‡æ›´æ–° + selector æ‹†åˆ† |
| T15 | æ–‡ä»¶æ ‘è™šæ‹ŸåŒ– | react-window æ›¿ä»£å…¨é‡æ¸²æŸ“ |
| T16 | LSP è‡ªåŠ¨é‡è¿ž | æŒ‡æ•°é€€é¿é‡è¿ž + è¯·æ±‚é˜Ÿåˆ— |
| T17 | Recovery è¿ç§» IndexedDB | æ›¿ä»£ localStorage |
| T18 | é‡è¯•ç­–ç•¥åŒºåˆ†é”™è¯¯ | 429 è¯» Retry-Afterã€500 æŒ‡æ•°é€€é¿ |
| T19 | Ghost Text ç«žæ€ä¿®å¤ | å®žä¾‹çº§ disposable ç®¡ç† |
| T20 | any ç±»åž‹æ¸…ç† | 323 â†’ 0 |
| T21 | è¡¥å…¨ç¼“å­˜ key å®‰å…¨ | æ·»åŠ é¡¹ç›®æ ‡è¯† + å“ˆå¸Œ |

### P2 - æž¶æž„æ¼”è¿›

| ç¼–å· | ä»»åŠ¡ | æ ¸å¿ƒæ“ä½œ |
|------|------|----------|
| T22 | Multi-file Edit | å¤šæ–‡ä»¶è”åŠ¨ç¼–è¾‘èƒ½åŠ› |
| T23 | @ Mentions | ä¸Šä¸‹æ–‡å¼•ç”¨ç³»ç»Ÿ |
| T24 | ç»“æž„åŒ–æ—¥å¿— | winston/pino æ›¿ä»£ console.log |
| T25 | æ’ä»¶å¸‚åœº | ç­¾å + æ²™ç›’ + åˆ†å‘ |
| T26 | æ€§èƒ½ç›‘æŽ§ Dashboard | ä¸»è¿›ç¨‹ + æ¸²æŸ“è¿›ç¨‹æŒ‡æ ‡ |
| T27 | æµ‹è¯•è¦†ç›–çŽ‡ 60% | å…³é”®è·¯å¾„é›†æˆæµ‹è¯• |
| T28 | E2E æµ‹è¯• | Playwright + Electron |

---

## ç¬¬å…­ç« ï¼šé™„å½•

### 6.1 é£Žé™©ç™»è®°è¡¨

| ID | é£Žé™© | çº§åˆ« | å½±å“ | æ¦‚çŽ‡ | çŠ¶æ€ |
|----|------|------|------|------|------|
| R1 | ç»ˆç«¯å‘½ä»¤æ³¨å…¥å¯¼è‡´ RCE | P0 | è‡´å‘½ | é«˜ | å¾…ä¿®å¤ |
| R2 | æ’ä»¶æ— æ²™ç›’å¯çªƒå–æ•°æ® | P0 | ä¸¥é‡ | ä¸­ | å¾…ä¿®å¤ |
| R3 | AI å“åº”æ— é™å¢žé•¿å¯¼è‡´ OOM | P0 | é«˜ | ä¸­ | å¾…ä¿®å¤ |
| R4 | API Key æ˜Žæ–‡æ³„éœ² | P0 | ä¸¥é‡ | ä¸­ | å¾…ä¿®å¤ |
| R5 | ç¬¦å·é“¾æŽ¥ç©¿è¶Šè¯»å–æ•æ„Ÿæ–‡ä»¶ | P0 | é«˜ | ä½Ž | å¾…ä¿®å¤ |
| R6 | LSP/DAP å‘½ä»¤æ³¨å…¥ | P0 | é«˜ | ä½Ž | å¾…ä¿®å¤ |
| R7 | ç´¢å¼• OOM | P0 | é«˜ | ä¸­ | å¾…ä¿®å¤ |
| R8 | æ¸²æŸ“é£Žæš´(AI æµå¼) | P1 | ä¸­ | é«˜ | å¾…ä¿®å¤ |
| R9 | LSP æ— é‡è¿ž | P1 | ä¸­ | é«˜ | å¾…ä¿®å¤ |
| R10 | 323 ä¸ª any ç±»åž‹ | P1 | ä½Ž | ç¡®å®š | å¾…æ¸…ç† |

### 6.2 æŒ‡æ ‡ä»ªè¡¨ç›˜

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ |
|------|--------|--------|
| P0 å®‰å…¨æ¼æ´ž | 13 | 0 |
| `any` ç±»åž‹æ•°é‡ | 323 | 0 |
| æµ‹è¯•è¦†ç›–çŽ‡ | ~25% | 60% |
| LSP é‡è¿žæˆåŠŸçŽ‡ | 0% | 99% |
| AI æµå¼ FPS | ~30 (é€ token) | 60 (æ‰¹é‡) |
| é¦–æ¬¡åŠ è½½æ—¶é—´ | æœªæµ‹é‡ | < 2s |
| å†…å­˜æ³„æ¼ç‚¹ | 2 (DiffEditor + Ghost Text) | 0 |

### 6.3 å…³é”®æ–‡ä»¶ç´¢å¼•

```
src/main/
  â”œâ”€â”€ index.ts              # ä¸»è¿›ç¨‹å…¥å£ (482è¡Œ)
  â”œâ”€â”€ preload.ts            # contextBridge ç™½åå• (738è¡Œ)
  â”œâ”€â”€ lsp-manager.ts        # LSP è¿›ç¨‹ç®¡ç†
  â”œâ”€â”€ debugger/dap-client.ts # DAP è°ƒè¯•é€‚é…å™¨
  â””â”€â”€ ipc/
      â”œâ”€â”€ fs-handlers.ts     # æ–‡ä»¶ç³»ç»Ÿ IPC
      â”œâ”€â”€ ai-handlers.ts     # AI IPC
      â”œâ”€â”€ git-handlers.ts    # Git IPC
      â”œâ”€â”€ terminal-handlers.ts # ç»ˆç«¯ IPC
      â”œâ”€â”€ settings-handlers.ts # è®¾ç½® IPC
      â”œâ”€â”€ debug-handlers.ts  # è°ƒè¯• IPC
      â”œâ”€â”€ lsp-handlers.ts    # LSP IPC
      â””â”€â”€ index-handlers.ts  # ç´¢å¼• IPC

src/core/
  â”œâ”€â”€ ai/
  â”‚   â”œâ”€â”€ llm-client.ts      # LLM å®¢æˆ·ç«¯ï¼ˆç†”æ–­/é‡è¯•ï¼‰
  â”‚   â”œâ”€â”€ model-router.ts    # æ¨¡åž‹è·¯ç”±
  â”‚   â”œâ”€â”€ request-pipeline.ts # è¯·æ±‚æµæ°´çº¿
  â”‚   â”œâ”€â”€ request-optimizer.ts # StreamBuffer/é¢„çƒ­/åŽ»é‡
  â”‚   â”œâ”€â”€ completion-service.ts # ä»£ç è¡¥å…¨æœåŠ¡
  â”‚   â”œâ”€â”€ contextManager.ts  # ä¸Šä¸‹æ–‡ç®¡ç†
  â”‚   â””â”€â”€ providers/         # 7ä¸ª AI Provider
  â”œâ”€â”€ plugins/
  â”‚   â”œâ”€â”€ manager.ts         # æ’ä»¶ç®¡ç†å™¨
  â”‚   â”œâ”€â”€ loader.ts          # æ’ä»¶åŠ è½½å™¨
  â”‚   â””â”€â”€ commands.ts        # å‘½ä»¤æ³¨å†Œè¡¨
  â”œâ”€â”€ indexing/
  â”‚   â””â”€â”€ indexService.ts    # ä»£ç ç´¢å¼•æœåŠ¡
  â”œâ”€â”€ lsp/client.ts          # LSP å®¢æˆ·ç«¯
  â”œâ”€â”€ recovery/index.ts      # å´©æºƒæ¢å¤
  â””â”€â”€ encoding.ts            # ç¼–ç æ£€æµ‹

src/renderer/
  â”œâ”€â”€ App.tsx                # ä¸»ç»„ä»¶ (755è¡Œ)
  â”œâ”€â”€ stores/
  â”‚   â”œâ”€â”€ useAIStore.ts      # AI çŠ¶æ€ (545è¡Œ)
  â”‚   â”œâ”€â”€ useFileStore.ts    # æ–‡ä»¶çŠ¶æ€
  â”‚   â””â”€â”€ useUIStore.ts      # UI çŠ¶æ€
  â”œâ”€â”€ components/
  â”‚   â”œâ”€â”€ CodeEditor.tsx     # Monaco é›†æˆ (702è¡Œ)
  â”‚   â””â”€â”€ DiffEditor.tsx     # å·®å¼‚ç¼–è¾‘å™¨
  â””â”€â”€ hooks/
      â”œâ”€â”€ useWorkspace.ts    # å·¥ä½œåŒº Hook
      â”œâ”€â”€ useEditorFiles.ts  # ç¼–è¾‘å™¨æ–‡ä»¶ Hook
      â””â”€â”€ useLSP.ts          # LSP Hook
```

---

*æŠ¥å‘Šç”Ÿæˆï¼šMindCode æž¶æž„å®¡è®¡ v1.0*
*æ€»è®¡å‘çŽ° 47 ä¸ªé—®é¢˜ | 13 P0 | 25 P1 | 9 P2*
